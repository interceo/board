# Forum Frontend - Modern Architecture

## Обзор

Этот frontend построен с использованием современной архитектуры JavaScript с четким разделением ответственности и лучшими практиками разработки.

## Архитектура

### Структура файлов

```
frontend/
├── js/
│   ├── app.js          # Главный файл приложения
│   ├── config.js       # Конфигурация
│   ├── events.js       # Система событий
│   ├── utility.js      # Утилиты
│   ├── api.js          # API клиент
│   ├── ui.js           # UI менеджер
│   └── router.js       # Роутер
├── templates/          # HTML шаблоны
├── css/               # Стили
└── index.html         # Главная страница
```

### Основные компоненты

#### 1. ForumApp (app.js)
Главный класс приложения, который:
- Инициализирует все модули
- Управляет состоянием приложения
- Обрабатывает глобальные ошибки
- Координирует взаимодействие между модулями

#### 2. ForumAPI (api.js)
Класс для работы с API:
- Кэширование запросов
- Retry логика
- Валидация данных
- Обработка ошибок
- Timeout для запросов

#### 3. ForumUI (ui.js)
Менеджер пользовательского интерфейса:
- Рендеринг компонентов
- Управление шаблонами
- Обработка форм
- Состояния загрузки и ошибок

#### 4. ForumRouter (router.js)
Клиентский роутер:
- Обработка URL
- Навигация между страницами
- Контроллеры для каждой страницы
- История браузера

#### 5. EventManager (events.js)
Система событий:
- Централизованное управление событиями
- Подписка/отписка от событий
- Обработка ошибок в обработчиках

#### 6. Utils (utility.js)
Утилиты:
- Экранирование HTML
- Форматирование дат
- Валидация
- Работа с URL
- Дополнительные хелперы

## Основные улучшения

### 1. Устранение дублирования кода
- Общие функции вынесены в утилиты
- Переиспользуемые компоненты UI
- Централизованная обработка ошибок

### 2. Лучшая обработка ошибок
- Глобальные обработчики ошибок
- Retry логика для API запросов
- Информативные сообщения об ошибках
- Graceful degradation

### 3. Производительность
- Кэширование API запросов
- Ленивая загрузка шаблонов
- Оптимизированный рендеринг
- Debounce/throttle для частых операций

### 4. Масштабируемость
- Модульная архитектура
- Система событий
- Конфигурация через файл
- Легкое добавление новых функций

### 5. Поддерживаемость
- Четкое разделение ответственности
- JSDoc документация
- Консистентный стиль кода
- Легкое тестирование

## Использование

### Инициализация
```javascript
// Приложение автоматически инициализируется при загрузке страницы
window.forumApp.init();
```

### Работа с API
```javascript
// Получение досок
const boards = await window.forumApp.api.getBoards();

// Создание поста
await window.forumApp.api.createPost(boardName, threadId, {
    author: 'User',
    content: 'Message'
});
```

### Подписка на события
```javascript
// Подписка на событие
EventBus.on(Events.BOARD_LOADED, (board) => {
    console.log('Board loaded:', board);
});

// Одноразовая подписка
EventBus.once(Events.APP_INITIALIZED, () => {
    console.log('App initialized');
});
```

### Обновление состояния
```javascript
// Обновление состояния приложения
window.forumApp.setState({
    currentBoard: 'general',
    isLoading: false
});
```

## Конфигурация

Все настройки приложения находятся в `config.js`:

- **API**: URL, timeout, retry настройки
- **Cache**: TTL, размер кэша
- **UI**: Анимации, задержки
- **Validation**: Правила валидации
- **Features**: Флаги функций
- **Debug**: Настройки отладки

## События

Приложение использует систему событий для коммуникации между модулями:

- `app:initialized` - Приложение инициализировано
- `route:changed` - Изменен маршрут
- `data:loaded` - Данные загружены
- `ui:loading:start/end` - Начало/конец загрузки
- `board:loaded` - Доска загружена
- `thread:loaded` - Тред загружен
- `post:created` - Пост создан

## Отладка

Включите отладку в конфигурации:
```javascript
Config.DEBUG.ENABLED = true;
Config.DEBUG.SHOW_API_LOGS = true;
```

## Производительность

- Кэширование API запросов (5 минут по умолчанию)
- LRU эвикция кэша
- Retry логика для неудачных запросов
- Оптимизированный рендеринг DOM
- Debounce для частых операций

## Безопасность

- Экранирование HTML для предотвращения XSS
- Валидация входных данных
- Безопасная работа с URL
- Обработка ошибок API

## Совместимость

- ES6+ классы
- Async/await
- Fetch API
- HTML5 History API
- Современные браузеры (IE11+)

## Разработка

### Добавление новой страницы

1. Создайте шаблон в `templates/`
2. Добавьте маршрут в `router.js`
3. Создайте контроллер в роутере
4. Добавьте рендеринг в `ui.js`

### Добавление нового API метода

1. Добавьте метод в `ForumAPI`
2. Добавьте валидацию
3. Настройте кэширование
4. Добавьте обработку ошибок

### Добавление нового события

1. Добавьте константу в `Events`
2. Используйте `EventBus.emit()` для отправки
3. Подпишитесь через `EventBus.on()` 